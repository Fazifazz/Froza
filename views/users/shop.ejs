<%- include('../layouts/header') %>

<body>

	<div class="colorlib-loader"></div>

	<div id="page">
		<%- include('../layouts/userNav') %>

		<div class="breadcrumbs">
			<div class="container">
				<div class="row">
                    <div class="col">
                        <p class="bread"><span><a href="index.html">Home</a></span> / <span>Shop</span></p>
					</div>

                    <% if (success && success.length > 0) { %>
                        <div class="alert alert-success text-center" id="success-message">
                          <% success.forEach(function(message) { %>
                            <p><%= message %></p>
                          <% }); %>
                        </div>
                        <script>
                            setTimeout(function() {
                              var successMessage = document.getElementById('success-message');
                              if (successMessage) {
                                successMessage.style.display = 'none';
                              }
                            }, 2000); 
                          </script>
                        <% } %>

                       
                    <% if (error && error.length > 0) { %>
                        <div class="alert alert-danger text-center" id="error-message">
                          <% error.forEach(function(message) { %>
                            <p><%= message %></p>
                          <% }); %>
                        </div>
                        <script>
                            setTimeout(function() {
                              var errorMessage = document.getElementById('error-message');
                              if (errorMessage) {
                                errorMessage.style.display = 'none';
                              }
                            }, 2000); 
                          </script>
                        <% } %>
                        
				</div>
			</div>
		</div>

		<div class="colorlib-product">
			<div class="container">
                <form action="/shop">
                    <button type="submit">Clear All Filters</button>
                </form>

				<div class="row">
					<div class="col-lg-3 col-xl-3">
						<div class="row">
							<div class="col-sm-12">
								<div class="side border mb-1">
									<h3>Brand</h3>
									<!-- Update the links with brand filters -->
                                    <ul>
                                        <% brands.forEach((brand) => { %>
                                            <li><a href="/shop?brand=<%= encodeURIComponent(brand) %>"><%= brand.toUpperCase() %></a></li>
                                        <% }); %>
                                    </ul>
                                    
                                    

								</div>
							</div>
                            <div class="col-sm-12">
                                <div class="side border mb-1">
                                    <h3>Price Range</h3>
                                    <form action="/shop" method="post">
                                        <label for="minPrice">Min Price:</label>
                                        <input type="text" id="minPrice" name="min">
                                        <label for="maxPrice">Max Price:</label>
                                        <input type="text" id="maxPrice" name="max">
                                        <center><button type="submit">Apply</button></center>
                                    </form>
                                </div>
                            </div>
<!-- Filter by Category -->
<div class="col-sm-12">
    <div class="side border mb-1">
        <h3>Category</h3>
        <ul>
            <% categories.forEach((category) => { %>
                <li><a href="/shop?category=<%= encodeURIComponent(category.name) %>"><%= category.name.toUpperCase() %></a></li>
            <% }); %>
        </ul>
    </div>
</div>



							<div class="col-sm-12">
								<div class="side border mb-1">
									<h3>Colors</h3>
									<ul>
										<li><a href="#">Black</a></li>
										<li><a href="#">White</a></li>
										<li><a href="#">Blue</a></li>
										<li><a href="#">Red</a></li>
										<li><a href="#">Green</a></li>
										<li><a href="#">Grey</a></li>
										<li><a href="#">Orange</a></li>
										<li><a href="#">Cream</a></li>
										<li><a href="#">Brown</a></li>
									</ul>
								</div>
							</div>
						</div>
					</div>

					<div class="col-lg-9 col-xl-9">
                        <!-- Add the conditional code to display the selected brand here -->
                        <p><span><%= totalItems %> </span> Products Found</p>
                        <span><h5><b>filtered by :</b>
                            <%= filterName %></h5></span>
                        <!-- Your product listing starts here -->
                        <div class="row row-pb-md">
                            <% products.forEach((prdct) => { %>
                                <% if (!prdct.is_deleted) { %>
                                    <div class="col-lg-3 mb-4 text-center">
                                        <div class="product-entry border">
                                            <div class="prod-img">
                                                <a href="/shop/<%= prdct._id %>">
                                                    <img src="<%= prdct.images[0] %>" class="img-fluid" alt="<%= prdct.title.toUpperCase()%>">
                                                </a>
                                            </div>
                                            <div class="desc">
                                                <h2><a href="#"><%= prdct.title.toUpperCase() %></a></h2>
                                                <h5 class="text-secondary"><%= prdct.brand.toUpperCase() %></h5>
                                                <span class="price">&#8377;<%= prdct.regularPrice %></span>
                                            </div>
                                            <% if(prdct.stock===0){ %>
                                                <p class="text-danger">Out of Stock!</p>
                                                <% }else{ %>
                                            <div class="icons">
                                                <form action="/cart/<%= prdct._id %>" method="post">
                                                    <input type="hidden" name="productId" value="<%= prdct._id %>">
                                                    <button class="btn btn-dark" type="submit">
                                                        <i class="fa fa-shopping-cart"></i> Add to Cart
                                                    </button>
                                                </form>
                                                <a class="btn btn-success" href="#">
                                                    <i class="fa fa-shopping-bag"></i> Shop Now
                                                </a>
                                            </div>
                                            <% } %>
                                        </div>
                                    </div>
                                <% } %>
                            <% }) %>
                        </div>

						<!-- Pagination -->
					   <div class="pageination">
                            <nav aria-label="Page navigation example">
                                <ul class="pagination justify-content-center">
                                    <!-- <li class="page-item">
                                        <a class="page-link" href="#" aria-label="Previous">
                                            <i class="ti-angle-double-left"></i>
                                        </a>
                                    </li> -->
                        
                                    <% for (let page = 1; page <= totalPages; page++) { %>
                                        <li class="page-item">
                                            <form action="/shop" method="post">
                                                <input type="hidden" name="pageNumber" value="<%= page-1 %>">
                                                <button class="page-link" type="submit"><%= page  %></button>
                                            </form>
                                        </li>
                                    <% } %>
                        
                                    <!-- <li class="page-item">
                                        <a class="page-link" href="#" aria-label="Next">
                                            <i class="ti-angle-double-right"></i>
                                        </a>
                                    </li> -->
                                </ul>
                            </nav>
                        </div>

              

					</div>
				</div>
			</div>
		</div>

  

		<%- include('../layouts/footer') %>
